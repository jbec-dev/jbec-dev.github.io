<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Modern Scoreboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:'Inter',sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
min-height:100vh;
}
.container{max-width:1200px;margin:auto;padding:30px}
.card{
background:rgba(255,255,255,0.08);
backdrop-filter:blur(15px);
border-radius:20px;
padding:25px;
box-shadow:0 10px 30px rgba(0,0,0,0.4);
margin-bottom:25px;
}
button{
padding:10px 18px;
border:none;
border-radius:10px;
background:linear-gradient(45deg,#00c6ff,#0072ff);
color:white;
font-weight:600;
cursor:pointer;
transition:.3s;
}
button:hover{transform:translateY(-2px)}
input,select{
width:100%;
padding:10px;
border-radius:10px;
border:none;
margin-bottom:10px;
background:rgba(255,255,255,0.1);
color:white;
}
.hidden{display:none}
.nav{display:flex;gap:20px;margin-bottom:20px}
.nav button{background:rgba(255,255,255,0.15)}
.active-tab{background:linear-gradient(45deg,#ff512f,#dd2476)!important}
.settings-btn{
position:fixed;bottom:30px;right:30px;
width:60px;height:60px;border-radius:50%;
display:flex;align-items:center;justify-content:center;
background:linear-gradient(45deg,#ff512f,#dd2476);
cursor:pointer;font-size:22px;
}
.modal{
position:fixed;inset:0;
background:rgba(0,0,0,0.7);
display:none;align-items:center;justify-content:center;
}
.modal-content{
background:#1f2933;padding:30px;border-radius:20px;
width:500px;max-height:90vh;overflow:auto;
}
table{width:100%;border-collapse:collapse}
th,td{padding:10px}
tr:nth-child(even){background:rgba(255,255,255,0.05)}
.red{color:#ff6b6b}
.blue{color:#4dabf7}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="card" style="max-width:400px;margin:120px auto;">
<h2>Login</h2>
<input id="username" placeholder="Username">
<input id="password" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- MAIN -->
<div id="mainPage" class="hidden container">

<h1>üèÜ Scoreboard</h1>

<div class="nav">
<button id="tabDashboard" class="active-tab" onclick="showTab('dashboard')">Dashboard</button>
<button id="tabRegister" onclick="showTab('register')">Register Game</button>
</div>

<!-- DASHBOARD -->
<div id="dashboardTab">
<div class="card">
<canvas id="scoreChart"></canvas>
</div>
<div class="card">
<h3>Match History</h3>
<table id="gamesTable"></table>
</div>
</div>

<!-- REGISTER -->
<div id="registerTab" class="hidden">
<div class="card">
<h3>Register Game</h3>

<label>Index</label>
<select id="gameIndex">
<option value="1">1</option>
<option value="2">2</option>
</select>

<label class="red">Player 1 (Red)</label>
<select id="p1"></select>

<label class="blue">Player 2 (Blue)</label>
<select id="p2"></select>

<label class="red">Optional Player 3</label>
<select id="p3"></select>

<label class="blue">Optional Player 4</label>
<select id="p4"></select>

<input type="number" id="redScore" placeholder="Red Score">
<input type="number" id="blueScore" placeholder="Blue Score">

<button onclick="registerGame()">Register Game</button>
</div>
</div>

<button onclick="logout()">Logout</button>
<div id="settingsBtn" class="settings-btn hidden" onclick="openSettings()">‚öô</div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" class="modal">
<div class="modal-content">
<h2>Admin Panel</h2>

<h3>Delete User</h3>
<select id="deleteUserSelect"></select>
<button onclick="deleteUser()">Delete</button>

<h3>Force Logout All</h3>
<button onclick="logoutAll()">Logout Everyone</button>

<br><br>
<button onclick="closeSettings()">Close</button>
</div>
</div>

<script>
let currentUser=null;
let chart;

async function hash(t){
const b=new TextEncoder().encode(t);
const h=await crypto.subtle.digest("SHA-256",b);
return Array.from(new Uint8Array(h)).map(x=>x.toString(16).padStart(2,"0")).join("");
}

async function init(){
if(!localStorage.users){
const h=await hash("admin");
localStorage.users=JSON.stringify({admin:{password:h}});
localStorage.games=JSON.stringify([]);
}
}
init();

async function login(){
const users=JSON.parse(localStorage.users);
const u=username.value;
const p=await hash(password.value);
if(users[u] && users[u].password===p){
currentUser=u;
loginPage.classList.add("hidden");
mainPage.classList.remove("hidden");
if(u==="admin"){
settingsBtn.classList.remove("hidden");
loadUserManagement();
}
loadDropdowns();
renderAll();
}else alert("Invalid login");
}

function logout(){location.reload()}
function logoutAll(){localStorage.clear();location.reload()}

function showTab(tab){
dashboardTab.classList.toggle("hidden",tab!=="dashboard");
registerTab.classList.toggle("hidden",tab!=="register");
tabDashboard.classList.toggle("active-tab",tab==="dashboard");
tabRegister.classList.toggle("active-tab",tab==="register");
}

function loadDropdowns(){
const users=JSON.parse(localStorage.users);
[p1,p2,p3,p4].forEach(s=>{
s.innerHTML="";
let none=document.createElement("option");
none.value="";
none.text="None";
s.appendChild(none);
for(let u in users){
let o=document.createElement("option");
o.value=u;o.text=u;
s.appendChild(o);
}
});
}

function loadUserManagement(){
const users=JSON.parse(localStorage.users);
deleteUserSelect.innerHTML="";
for(let u in users){
if(u!=="admin"){
let o=document.createElement("option");
o.value=u;o.text=u;
deleteUserSelect.appendChild(o);
}
}
}

function registerGame(){
const red=Number(redScore.value);
const blue=Number(blueScore.value);
if(isNaN(red)||isNaN(blue)){alert("Enter valid scores");return;}

let games=JSON.parse(localStorage.games);
games.push({
id:Date.now(),
date:new Date().toISOString().split("T")[0],
redPlayers:[p1.value,p3.value].filter(x=>x),
bluePlayers:[p2.value,p4.value].filter(x=>x),
redScore:red,
blueScore:blue,
points:Math.abs(red-blue)*10
});
localStorage.games=JSON.stringify(games);
renderAll();
alert("Game registered!");
}

function deleteGame(id){
if(currentUser!=="admin") return;
let games=JSON.parse(localStorage.games);
games=games.filter(g=>g.id!==id);
localStorage.games=JSON.stringify(games);
renderAll();
}

function deleteUser(){
let users=JSON.parse(localStorage.users);
delete users[deleteUserSelect.value];
localStorage.users=JSON.stringify(users);
loadUserManagement();
loadDropdowns();
}

function calculateScores(){
const users=JSON.parse(localStorage.users);
const games=JSON.parse(localStorage.games);
let scores={};
for(let u in users) scores[u]=0;
games.forEach(g=>{
const winners=g.redScore>g.blueScore?g.redPlayers:g.bluePlayers;
const losers=g.redScore>g.blueScore?g.bluePlayers:g.redPlayers;
winners.forEach(p=>scores[p]+=g.points);
losers.forEach(p=>scores[p]-=g.points);
});
return scores;
}

function renderChart(){
const scores=calculateScores();
const labels=Object.keys(scores);
const data=Object.values(scores);
if(chart) chart.destroy();
chart=new Chart(scoreChart,{
type:"bar",
data:{labels,datasets:[{label:"Total Score",data}]},
options:{
plugins:{legend:{labels:{color:"white"}}},
scales:{x:{ticks:{color:"white"}},y:{ticks:{color:"white"}}}
}
});
}

function renderGames(){
const games=JSON.parse(localStorage.games);
let html="<tr><th>Date</th><th>Match</th><th>Score</th>";
if(currentUser==="admin") html+="<th>Delete</th>";
html+="</tr>";
games.slice().reverse().forEach(g=>{
html+="<tr>";
html+=`<td>${g.date}</td>`;
html+=`<td><span class="red">${g.redPlayers.join(",")}</span> vs <span class="blue">${g.bluePlayers.join(",")}</span></td>`;
html+=`<td>${g.redScore} - ${g.blueScore}</td>`;
if(currentUser==="admin")
html+=`<td><button onclick="deleteGame(${g.id})">X</button></td>`;
html+="</tr>";
});
gamesTable.innerHTML=html;
}

function renderAll(){
renderChart();
renderGames();
}

function openSettings(){settingsModal.style.display="flex"}
function closeSettings(){settingsModal.style.display="none"}
</script>
</body>
</html>
