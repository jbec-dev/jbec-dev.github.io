<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Modern Scoreboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
* { box-sizing:border-box }

body {
    margin:0;
    font-family:'Inter', sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:white;
    min-height:100vh;
}

h1,h2,h3 { margin:0 0 15px 0 }

.container {
    padding:30px;
    max-width:1200px;
    margin:auto;
}

.card {
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(15px);
    border-radius:20px;
    padding:25px;
    box-shadow:0 10px 30px rgba(0,0,0,0.4);
    margin-bottom:25px;
}

.grid {
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:25px;
}

input, select {
    width:100%;
    padding:10px;
    border-radius:10px;
    border:none;
    margin-bottom:10px;
    background:rgba(255,255,255,0.1);
    color:white;
}

button {
    padding:10px 18px;
    border:none;
    border-radius:10px;
    background:linear-gradient(45deg,#00c6ff,#0072ff);
    color:white;
    font-weight:600;
    cursor:pointer;
    transition:0.3s;
}

button:hover {
    transform:translateY(-2px);
    box-shadow:0 5px 15px rgba(0,0,0,0.3);
}

.login-box {
    max-width:400px;
    margin:120px auto;
}

.hidden { display:none }

.red { color:#ff6b6b; font-weight:600 }
.blue { color:#4dabf7; font-weight:600 }

table {
    width:100%;
    border-collapse:collapse;
}
th,td {
    padding:10px;
    text-align:left;
}
tr:nth-child(even){
    background:rgba(255,255,255,0.05);
}

.settings-btn {
    position:fixed;
    bottom:30px;
    right:30px;
    width:60px;
    height:60px;
    border-radius:50%;
    font-size:22px;
    background:linear-gradient(45deg,#ff512f,#dd2476);
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    box-shadow:0 5px 20px rgba(0,0,0,0.4);
    transition:0.3s;
}
.settings-btn:hover { transform:rotate(90deg) }

.modal {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.7);
    display:none;
    align-items:center;
    justify-content:center;
}
.modal-content {
    background:#1f2933;
    padding:30px;
    border-radius:20px;
    width:500px;
    max-height:90vh;
    overflow:auto;
}

@media(max-width:900px){
    .grid { grid-template-columns:1fr }
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" class="login-box card">
    <h2>üîê Login</h2>
    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
</div>

<!-- MAIN -->
<div id="mainPage" class="hidden container">

    <h1>üèÜ Scoreboard Dashboard</h1>

    <div class="card">
        <canvas id="scoreChart"></canvas>
    </div>

    <div class="grid">
        <div class="card">
            <h3>üéÆ Register Game</h3>

            <label>Index</label>
            <select id="gameIndex">
                <option value="1">1</option>
                <option value="2">2</option>
            </select>

            <label class="red">Player 1 (Red)</label>
            <select id="p1"></select>

            <label class="blue">Player 2 (Blue)</label>
            <select id="p2"></select>

            <label class="red">Optional Player 3 (Red)</label>
            <select id="p3"></select>

            <label class="blue">Optional Player 4 (Blue)</label>
            <select id="p4"></select>

            <input type="number" id="redScore" placeholder="Red Score">
            <input type="number" id="blueScore" placeholder="Blue Score">

            <button onclick="registerGame()">Register Game</button>
        </div>

        <div class="card">
            <h3>üìÖ Last 3 Days</h3>
            <table id="historyTable"></table>
        </div>
    </div>

    <button onclick="logout()">Logout</button>
    <div id="settingsBtn" class="settings-btn hidden" onclick="openSettings()">‚öô</div>
</div>

<!-- SETTINGS -->
<div id="settingsModal" class="modal">
<div class="modal-content">
<h2>‚öô Admin Panel</h2>

<h3>Create User</h3>
<input id="newUser" placeholder="Username">
<input id="newPass" placeholder="Password">
<button onclick="createUser()">Create</button>

<h3>Change Password</h3>
<select id="changeUser"></select>
<input id="changePass" placeholder="New Password">
<button onclick="changePassword()">Change</button>

<h3>Rename User</h3>
<select id="renameUserSelect"></select>
<input id="renameInput" placeholder="New Name">
<button onclick="renameUser()">Rename</button>

<h3>Delete User</h3>
<select id="deleteUserSelect"></select>
<button onclick="deleteUser()">Delete</button>

<h3>Force Logout All</h3>
<button onclick="logoutAll()">Logout Everyone</button>

<br><br>
<button onclick="closeSettings()">Close</button>
</div>
</div>

<script>
let currentUser=null;
let chart;

async function hash(text){
    const buf=new TextEncoder().encode(text);
    const hash=await crypto.subtle.digest("SHA-256",buf);
    return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function init(){
    if(!localStorage.users){
        const h=await hash("admin");
        localStorage.users=JSON.stringify({
            admin:{password:h,scoreHistory:[]}
        });
    }
}
init();

async function login(){
    const users=JSON.parse(localStorage.users);
    const u=username.value;
    const p=await hash(password.value);
    if(users[u] && users[u].password===p){
        currentUser=u;
        loginPage.classList.add("hidden");
        mainPage.classList.remove("hidden");
        if(u==="admin") settingsBtn.classList.remove("hidden");
        loadDropdowns();
        drawChart();
        loadHistory();
    } else alert("Invalid login");
}

function logout(){ location.reload(); }
function logoutAll(){ localStorage.clear(); location.reload(); }

function loadDropdowns(){
    const users=JSON.parse(localStorage.users);
    const selects=[p1,p2,p3,p4,changeUser,deleteUserSelect,renameUserSelect];
    selects.forEach(s=>s.innerHTML="");
    for(let u in users){
        selects.forEach(s=>{
            let o=document.createElement("option");
            o.value=u; o.text=u;
            s.appendChild(o.cloneNode(true));
        });
    }
}

function registerGame(){
    const users=JSON.parse(localStorage.users);
    const red=+redScore.value;
    const blue=+blueScore.value;
    const diff=Math.abs(red-blue)*10;
    const date=new Date().toISOString().split("T")[0];

    const redPlayers=[p1.value,p3.value];
    const bluePlayers=[p2.value,p4.value];
    const winners=red>blue?redPlayers:bluePlayers;
    const losers=red>blue?bluePlayers:redPlayers;

    winners.forEach(p=>{ if(p) users[p].scoreHistory.push({date,score:diff}); });
    losers.forEach(p=>{ if(p) users[p].scoreHistory.push({date,score:-diff}); });

    localStorage.users=JSON.stringify(users);
    drawChart();
    loadHistory();
}

function drawChart(){
    const users=JSON.parse(localStorage.users);
    const labels=[];
    const datasets=[];
    for(let u in users){
        let total=0;
        const data=[];
        users[u].scoreHistory.forEach(e=>{
            total+=e.score;
            labels.push(e.date);
            data.push(total);
        });
        datasets.push({
            label:u,
            data:data,
            tension:0.4
        });
    }
    if(chart) chart.destroy();
    chart=new Chart(scoreChart,{
        type:"line",
        data:{labels:[...new Set(labels)],datasets},
        options:{
            plugins:{legend:{labels:{color:"white"}}},
            scales:{
                x:{ticks:{color:"white"}},
                y:{ticks:{color:"white"}}
            }
        }
    });
}

function loadHistory(){
    const users=JSON.parse(localStorage.users);
    const cutoff=new Date();
    cutoff.setDate(cutoff.getDate()-3);
    let html="<tr><th>Name</th><th>Score</th></tr>";
    for(let u in users){
        let total=0;
        users[u].scoreHistory.forEach(e=>{
            if(new Date(e.date)>=cutoff) total+=e.score;
        });
        html+=`<tr><td>${u}</td><td>${total}</td></tr>`;
    }
    historyTable.innerHTML=html;
}

async function createUser(){
    const users=JSON.parse(localStorage.users);
    users[newUser.value]={password:await hash(newPass.value),scoreHistory:[]};
    localStorage.users=JSON.stringify(users);
    loadDropdowns();
}

async function changePassword(){
    const users=JSON.parse(localStorage.users);
    users[changeUser.value].password=await hash(changePass.value);
    localStorage.users=JSON.stringify(users);
}

function deleteUser(){
    const users=JSON.parse(localStorage.users);
    delete users[deleteUserSelect.value];
    localStorage.users=JSON.stringify(users);
    loadDropdowns();
}

function renameUser(){
    const users=JSON.parse(localStorage.users);
    users[renameInput.value]=users[renameUserSelect.value];
    delete users[renameUserSelect.value];
    localStorage.users=JSON.stringify(users);
    loadDropdowns();
}

function openSettings(){ settingsModal.style.display="flex"; }
function closeSettings(){ settingsModal.style.display="none"; }
</script>

</body>
</html>
